# For educational purposes only
version: 1
template_name: focus_arbitr_monitor
meta:
  id: deep-dive.focus_arbitr_monitor
  name: "Мониторинг арбитражных решений"
  description: "Полноценный парсинг с HTML-ответом"

source:
  type: html
  url: "https://focus.kontur.ru/content/mon"
  method: GET
  frequency: hourly  # Обязательное поле
  fetch:
    headers:
      # Isert your headers here
    body: "jurisdiction=78&type=arbitration&limit=100" #Change city code here
    verify_ssl: false
    timeout: 30
    retry_policy:  
      max_retries: 3
      backoff_factor: 2

extract:
  events:
    selector: 'a[href*="pdf"]'
    type: list  
    limit: 2
    fields: 
      title: "self"
      url: 
        attr: "href"
        transform_type: "smart_url"

download:
  extensextensions: [".pdf"]  
  timeout: 20    

processing: {}


normalize:
  rules:
    - field: events
      filters:
        - unique: "url"
        - filter: "documents"
          condition: "'Санкт-Петербург' in item.text.lower()"

gpt:
  prompt: |
    
    Проанализируй текст судебного решения и выдели:

    1. Кто истец
    2. Кто ответчик
    3. Суть решения

    Вот текст: {{ text }}

alert:
  templates:
    expertise: |
      {% for event in events %}
      === Судебный акт {{ loop.index }} ===
      Название: {{ event.title }}
      {% if event.gpt is not none and event.gpt %}
      Анализ:
      {% for key, value in event.gpt.items() %}
      - {{ key }}: {{ value }}
      {% endfor %}
      {% else %}
      ℹ️ Анализ отсутствует
      {% endif %}
      {% endfor %}