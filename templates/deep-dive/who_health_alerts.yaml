version: 1.0

meta:
  title: WHO Global Health Alerts
  description: |
    Monitor health emergency alerts and outbreak bulletins from the World Health Organization (WHO).
    If a PDF is available, it will be downloaded and summarized. If not, HTML page content is used instead.
  tags: [who, health, outbreaks, pdf, ai, multilingual]
  lang: en
  category: global_health
  status: spec-draft

source:
  type: rss
  url: https://www.who.int/feeds/entity/emergencies/disease-outbreak-news/en/rss.xml

fetch:
  schedule: "0 */6 * * *"
  ttl: 24h
  headers:
    User-Agent: rostral-bot/1.0

extract:
  raw_text: "section.main-content"
  title: h1
  date: time::attr(datetime)
  pdf: a[href$=".pdf"]::attr(href)

normalize:
  trim: true
  fields:
    country: extract_by_pattern("Country:\\s+([A-Z][a-zA-Z\\s]+)")
    event_type: extract_by_keywords(["cholera", "dengue", "ebola", "covid", "nipah"])
    affected: extract_by_regex("(?i)(\\d{2,6}) (cases|deaths|confirmed)")
    region: extract_by_pattern("Region:\\s+([\\w\\s]+)")
    keywords: detect_keywords()
    document: "{{ pdf }}"

gpt:
  model: gpt-4
  temperature: 0.3
  prompt: |
    You are processing a health alert from WHO.
    Summarize the key content of the alert based on the input text, which may come from either a PDF or the webpage itself.
    Focus on:
    - Type of outbreak or event
    - Region(s) and country affected
    - Severity: confirmed cases, deaths, urgency
    - Any recommended actions or measures
    Output 2â€“3 concise sentences in neutral tone.

alert:
  template: |
    ðŸš¨ [WHO Alert] {{ normalized.event_type or 'Unknown event' }} in {{ normalized.country or normalized.region or 'Unknown location' }}

    {{ gpt_summary or 'No summary available.' }}

    ðŸ“Ž PDF: {{ document_link or 'No document available' }}
    {% if normalized.keywords %}
    ðŸ§ª Tags: {{ normalized.keywords | default([]) | join(', ') }}
    {% endif %}

test_event:
  url: https://www.who.int/emergencies/disease-outbreak-news/item/2023-DON442
